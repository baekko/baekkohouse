<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>ê´€ì¥ë‹˜ì˜ ë¹„ë°€ì—…ë¬´</title>
<style>
  body{
    background-image:url("ctmt32.jpg");
    background-size:cover;background-position:center;background-attachment:fixed;
    font-family:Arial,sans-serif;margin:0;
  }
  .image-container{
    display:flex;justify-content:center;gap:8px;padding:10px;
    position:fixed;bottom:85px;left:50%;transform:translateX(-50%);width:auto;
  }
  .image-box{
    width:15px;height:70px;border:1px solid white;display:flex;justify-content:center;align-items:center;
    background:#fff;cursor:pointer;flex-shrink:0;box-shadow:0 4px 6px rgba(0,0,0,.2);
  }
  .button-container{
    position:fixed;bottom:15px;left:50%;transform:translateX(-50%);display:flex;gap:10px;
  }
  .submit-button{
    position:fixed;bottom:55px;left:50%;transform:translateX(-50%);
  }
  button{
    padding:4px 6px;width:65px;font-size:12px;font-weight:bold;cursor:pointer;color:#fff;
    background:orange;border:none;border-radius:5px;box-shadow:0 4px 6px rgba(0,0,0,.466);
  }
  button:disabled{background:rgb(109,93,93)!important;cursor:not-allowed;opacity:.8}
  .modal{
    display:none;position:fixed;z-index:1000;left:50%;top:50%;transform:translate(-50%,-50%);
    width:300px;padding:15px;background:#fff;border-radius:10px;box-shadow:0 4px 8px rgba(0,0,0,.2);
  }
  .modal-content{text-align:center;position:relative;}
  .close{
    position:absolute;top:50%;right:10px;transform:translateY(-50%);
    font-size:20px;font-weight:bold;cursor:pointer;
  }
  @media (max-width:768px){
    .image-box{width:15px;height:70px;}
    button{font-size:12px;padding:4px 6px;}
  }

  /* ë³´ìƒ ì˜ìƒ ì˜¤ë²„ë ˆì´ */
  .video-overlay{
    display:none;position:fixed;inset:0;background:rgba(0,0,0,.6);
    z-index:2000;align-items:center;justify-content:center;
  }
  .video-box{
    width:min(70vw,420px);background:#000;border-radius:12px;overflow:hidden;
    box-shadow:0 10px 24px rgba(0,0,0,.35);
  }
  video{width:100%;height:auto;display:block}
</style>
</head>
<body>
  <div class="image-container" id="imageContainer"></div>

  <button class="submit-button" onclick="checkAnswer()">ì…ë ¥</button>

  <div class="button-container">
    <button id="hint1" onclick="useHint1()">íŒíŠ¸ 1</button>
    <button id="hint2" onclick="useHint2()" disabled>íŒíŠ¸ 2</button>
    <button id="answerBtn" onclick="showAnswerModal()" disabled>ì •ë‹µ ë³´ê¸°</button>
    <button id="totalBtn">ì¸„ë¥´ í•©ê³„</button>
  </div>

  <div id="modal" class="modal">
    <div class="modal-content">
      <span class="close" id="closeModal">&times;</span>
      <p id="modalText"></p>
    </div>
  </div>

  <!-- ë³´ìƒ ì˜ìƒ -->
  <div id="videoOverlay" class="video-overlay" aria-hidden="true">
    <div class="video-box">
      <video id="rewardVideo" playsinline muted></video>
    </div>
  </div>

<script>
/* ===== í¼ì¦ ì„¸íŒ… ===== */
const images = ['a','b','c','d','e'];                       // a~e ì´ë¯¸ì§€
const correctCounts = { a:3, b:3, c:3, d:1, e:1 };          // ì •ë‹µ ê°œìˆ˜
let selectedImages = Array(11).fill('a');                   // ì´ˆê¸°ê°’

/* ===== í˜ì´ì§€ ì „ì—­ ===== */
const nextUrl = "https://baekko.github.io/baekkohouse/ctm33.html";
let hintLevel = 0;  // 0: ì—†ìŒ, 1: íŒíŠ¸1, 2: íŒíŠ¸2, 3: ì •ë‹µë³´ê¸°

/* ===== ëˆ„ì /ì¤‘ë³µ ë°©ì§€ í‚¤ ===== */
const CHURU_KEY = "churuTotal";
const PAGE_KEY  = "settled:" + location.pathname; // ì´ í˜ì´ì§€ëŠ” 1íšŒë§Œ ê°€ì‚°
if (localStorage.getItem(CHURU_KEY) === null) localStorage.setItem(CHURU_KEY,"0");

/* ===== ì—˜ë¦¬ë¨¼íŠ¸ ===== */
const $modal = document.getElementById('modal');
const $modalText = document.getElementById('modalText');
const $close = document.getElementById('closeModal');
const $hint1 = document.getElementById('hint1');
const $hint2 = document.getElementById('hint2');
const $ansBtn = document.getElementById('answerBtn');
const $totalBtn = document.getElementById('totalBtn');
const $overlay = document.getElementById('videoOverlay');
const $video = document.getElementById('rewardVideo');

/* ===== UI: ì´ë¯¸ì§€ ë Œë” ===== */
function renderImages(){
  const container = document.getElementById("imageContainer");
  container.innerHTML = "";
  selectedImages.forEach((img, idx)=>{
    const div = document.createElement("div");
    div.className = "image-box";
    const el = document.createElement("img");
    el.src = `${img}.png`;
    el.alt = `Image ${img.toUpperCase()}`;
    el.style.width = "100%";
    el.style.height = "100%";
    div.appendChild(el);
    div.onclick = ()=> cycleImage(idx);
    container.appendChild(div);
  });
}
function cycleImage(index){
  const cur = images.indexOf(selectedImages[index]);
  selectedImages[index] = images[(cur + 1) % images.length];
  renderImages();
}

/* ===== ëª¨ë‹¬ ===== */
function openModal(txt){ $modalText.innerText = txt; $modal.style.display = "block"; }
function closeModal(){ $modal.style.display = "none"; }
$close.onclick = closeModal;
window.addEventListener('click', e => { if (e.target === $modal) closeModal(); });

/* ===== íŒíŠ¸/ì •ë‹µ ë³´ê¸° ===== */
function useHint1(){
  openModal("5ê°€ì§€ ë§› ëª¨ë‘ ìµœì†Œ 1ê°œ ì´ìƒì€ í•„ìš”í•´!");
  if (hintLevel < 1) hintLevel = 1;
  $hint2.disabled = false;
}
function useHint2(){
  openModal("íšŒìƒ‰ì€ í°ìƒ‰ê³¼ ê²€ì€ìƒ‰ì˜ 1ëŒ€1 ë¹„ìœ¨ì˜\nì¡°í•©ìœ¼ë¡œ ë§Œë“¤ì–´ì ¸!");
  if (hintLevel < 2) hintLevel = 2;
  $ansBtn.disabled = false;
}
function showAnswerModal(){
  openModal("ë¹¨ê°„ìƒ‰ 3ê°œ, ë…¸ë€ìƒ‰ 3ê°œ, íŒŒë€ìƒ‰ 3ê°œ\ní°ìƒ‰ 1ê°œ, ê²€ì€ìƒ‰ 1ê°œ");
  if (hintLevel < 3) hintLevel = 3;
}
$totalBtn.onclick = ()=>{
  const t = Number(localStorage.getItem(CHURU_KEY)||"0");
  openModal(`í˜„ì¬ê¹Œì§€ íšë“í•œ ì¸„ë¥´: ${t}ê°œ`);
};

/* ===== ì •ë‹µ í™•ì¸ ===== */
function checkAnswer(){
  const counts = { a:0, b:0, c:0, d:0, e:0 };
  selectedImages.forEach(k => { if (counts.hasOwnProperty(k)) counts[k]++; });

  const ok = Object.keys(correctCounts).every(k => counts[k] === correctCounts[k]);

  if (ok){
    closeModal();
    handleCorrectOnce();
  }else{
    openModal("ì¸„ë¥´ë¥¼ ë‹¤ì‹œ ì¡°í•©í•´ì•¼í•´!");
  }
}

/* ===== ì •ë‹µ ì²˜ë¦¬: í•œ ë²ˆë§Œ ê°€ì‚° â†’ ë³´ìƒì˜ìƒ â†’ ë‹¤ìŒ í˜ì´ì§€ ===== */
function handleCorrectOnce(){
  if (localStorage.getItem(PAGE_KEY) === "1"){
    playRewardAndGo(); // ì´ë¯¸ ì²˜ë¦¬ë¨ â†’ ê°€ì‚° ì—†ì´ ì˜ìƒë§Œ
    return;
  }
  const addMap = [3,2,1,0]; // íŒíŠ¸ ì‚¬ìš©ëŸ‰ë³„ íšë“ëŸ‰
  const add = addMap[hintLevel] ?? 0;
  const cur = Number(localStorage.getItem(CHURU_KEY)||"0");
  localStorage.setItem(CHURU_KEY, String(cur + add));
  localStorage.setItem(PAGE_KEY, "1"); // âœ… ì¤‘ë³µê°€ì‚° ë°©ì§€

  playRewardAndGo();
}

function playRewardAndGo(){
  const src = ["curu1.mp4","curu2.mp4","curu3.mp4","curu4.mp4"][hintLevel] || "curu4.mp4";
  $video.src = src;

  // ğŸ”‡ ìŒì†Œê±° ë³´ì¥ (ëª¨ë°”ì¼ ìë™ì¬ìƒ í˜¸í™˜)
  $video.muted = true; $video.defaultMuted = true; $video.volume = 0;

  $video.currentTime = 0;
  $overlay.style.display = "flex";
  $overlay.setAttribute("aria-hidden","false");

  // í•˜ë‹¨ ë²„íŠ¼ ì ê¸ˆ
  [$hint1,$hint2,$ansBtn,$totalBtn].forEach(b=>b.disabled = true);

  // ì˜ìƒ ì¢…ë£Œ â†’ ë‹¤ìŒ í˜ì´ì§€
  $video.onended = () => { location.href = nextUrl; };

  const p = $video.play();
  if (p && typeof p.catch === "function"){
    p.catch(()=>{ $video.setAttribute('controls','controls'); });
  }
}

/* ì´ˆê¸° ë Œë” */
document.addEventListener("DOMContentLoaded", renderImages);
</script>
</body>
</html>

