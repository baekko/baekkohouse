<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ê´€ì¥ë‹˜ì˜ ë¹„ë°€ì—…ë¬´</title>
  <style>
    body{
      background-image:url("ctmt12.jpg");
      background-size:cover;background-position:center;background-attachment:fixed;
      font-family:Arial,sans-serif;margin:0;
    }

    /* ë°©í–¥í‚¤ ê·¸ë¦¬ë“œ */
    .button-grid{
      display:grid;
      grid-template-columns:repeat(3,35px);
      grid-template-rows:repeat(3,35px);
      grid-template-areas:
        ". up ."
        "left confirm right"
        ". down .";
      gap:15px;
      justify-content:center;
      align-items:center;
      position:absolute;
      left:50%;
      bottom:60px;
      transform:translateX(-50%);
    }
    .direction-button,.confirm-button{
      width:35px;height:35px;font-size:35px;cursor:pointer;
      background:#00A6ED;color:#fff;border-radius:5px;
      box-shadow:3px 3px 5px rgba(0,0,0,.4);
      transition:all .3s ease-in-out;
      display:flex;align-items:center;justify-content:center;
      font-family:"Apple Color Emoji","Segoe UI Emoji","Noto Color Emoji",sans-serif;
      line-height:1;text-align:center;border:none;
    }
    .confirm-button{font-size:12px}
    .direction-button:hover,.confirm-button:hover{
      box-shadow:4px 4px 7px rgba(0,0,0,.5);transform:scale(1.1);
    }
    .direction-button:active,.confirm-button:active{transform:scale(1.0);}
    .direction-button.up{grid-area:up}
    .direction-button.left{grid-area:left}
    .direction-button.right{grid-area:right}
    .direction-button.down{grid-area:down}
    .confirm-button{grid-area:confirm}

    /* í•˜ë‹¨ ì»¨íŠ¸ë¡¤ ë²„íŠ¼ */
    .button-container{
      position:fixed;bottom:15px;left:50%;transform:translateX(-50%);
      display:flex;gap:10px;
    }
    button{
      padding:4px 6px;font-size:12px;font-weight:bold;width:65px;cursor:pointer;
      color:#fff;background:orange;border:none;border-radius:5px;
      box-shadow:0 4px 6px rgba(0,0,0,.466);
    }
    button:disabled{background:rgb(109,93,93)!important;cursor:not-allowed;opacity:.8}

    /* ëª¨ë‹¬ */
    .modal{
      display:none;position:fixed;z-index:1000;left:50%;top:50%;
      transform:translate(-50%,-50%);width:300px;padding:15px;background:#fff;
      border-radius:10px;box-shadow:0 4px 8px rgba(0,0,0,.2);
    }
    .modal-content{text-align:center;}
    .close{float:right;cursor:pointer;font-size:20px;font-weight:bold;}

    /* ì •ë‹µ ë³´ìƒ ì˜ìƒ ì˜¤ë²„ë ˆì´ */
    .video-overlay{
      display:none; /* ì´ˆê¸°ì—” ë°˜ë“œì‹œ none */
      position:fixed;inset:0;background:rgba(0,0,0,.6);
      z-index:2000;align-items:center;justify-content:center;
    }
    .video-box{
      width:min(70vw,420px);background:#000;border-radius:12px;overflow:hidden;
      box-shadow:0 10px 24px rgba(0,0,0,.35);
    }
    video{width:100%;height:auto;display:block}

    /* ëª¨ë°”ì¼ ìµœì í™” */
    @media (max-width:768px){
      .button-grid{
        grid-template-columns:repeat(3,35px);
        grid-template-rows:repeat(3,35px);
        gap:10px;
      }
      .direction-button{width:35px;height:35px;font-size:35px;}
      .confirm-button{font-size:12px;}
    }
  </style>
</head>
<body>
  <!-- ë°©í–¥ ì…ë ¥ UI -->
  <div class="button-grid">
    <button class="direction-button up"    onclick="recordDirection('up')">ğŸ”¼</button>
    <button class="direction-button left"  onclick="recordDirection('left')">â—€ï¸</button>
    <button class="confirm-button"         onclick="checkSequence()">ì…ë ¥</button>
    <button class="direction-button right" onclick="recordDirection('right')">â–¶ï¸</button>
    <button class="direction-button down"  onclick="recordDirection('down')">ğŸ”½</button>
  </div>

  <!-- í•˜ë‹¨ ì»¨íŠ¸ë¡¤ -->
  <div class="button-container">
    <button id="hint1">íŒíŠ¸ 1</button>
    <button id="hint2" disabled>íŒíŠ¸ 2</button>
    <button id="answerBtn" disabled>ì •ë‹µ ë³´ê¸°</button>
    <button id="totalBtn">ì¸„ë¥´ í•©ê³„</button>
  </div>

  <!-- ì•ˆë‚´ ëª¨ë‹¬ -->
  <div id="modal" class="modal">
    <div class="modal-content">
      <span class="close" id="closeModal">&times;</span>
      <p id="modalText"></p>
    </div>
  </div>

  <!-- ë³´ìƒ ì˜ìƒ -->
  <div id="videoOverlay" class="video-overlay" aria-hidden="true">
    <div class="video-box">
      <video id="rewardVideo" playsinline muted></video>
    </div>
  </div>

<script>
/* ===== í¼ì¦ ì •ë‹µ ì‹œí€€ìŠ¤ & í˜ì´ì§€ë³„ ì„¤ì • ===== */
const correctSequence = ['down','left','up','right','up','right','up'];
const nextUrl = "https://baekko.github.io/baekkohouse/ctm13.html";

/* ===== ì…ë ¥ ìƒíƒœ ===== */
let userInput = [];               // ì‚¬ìš©ìê°€ ëˆ„ë¥¸ ë°©í–¥ ê¸°ë¡ (ìµœëŒ€ 7)
let hintLevel = 0;                // 0: ì—†ìŒ, 1: íŒíŠ¸1, 2: íŒíŠ¸2, 3: ì •ë‹µë³´ê¸°

/* ===== ì¤‘ë³µê°€ì‚° ë°©ì§€ & í•©ì‚° í‚¤ ===== */
const CHURU_KEY = "churuTotal";
const PAGE_KEY  = "settled:" + location.pathname; // ì´ ê²½ë¡œ ë¬¸ì œëŠ” í•œ ë²ˆë§Œ ê°€ì‚°
if (localStorage.getItem(CHURU_KEY) === null) localStorage.setItem(CHURU_KEY,"0");

/* ===== ì—˜ë¦¬ë¨¼íŠ¸ ===== */
const $modal = document.getElementById('modal');
const $modalText = document.getElementById('modalText');
const $close = document.getElementById('closeModal');

const $hint1 = document.getElementById('hint1');
const $hint2 = document.getElementById('hint2');
const $ansBtn = document.getElementById('answerBtn');
const $totalBtn = document.getElementById('totalBtn');

const $overlay = document.getElementById('videoOverlay');
const $video = document.getElementById('rewardVideo');

/* ===== ëª¨ë‹¬ ê³µí†µ ===== */
function openModal(txt){ $modalText.innerText = txt; $modal.style.display = "block"; }
function closeModal(){ $modal.style.display = "none"; }
$close.onclick = closeModal;
window.addEventListener('click', e => { if (e.target === $modal) closeModal(); });

/* ===== ë°©í–¥ ê¸°ë¡ ===== */
function recordDirection(dir){
  if (userInput.length < correctSequence.length){
    userInput.push(dir);
  }
}

/* ===== ì…ë ¥ í™•ì¸ ===== */
function checkSequence(){
  const isCorrect =
    userInput.length === correctSequence.length &&
    userInput.every((v,i)=> v === correctSequence[i]);

  if (isCorrect){
    closeModal();
    handleCorrectOnce();
  }else{
    openModal("ê·¸ ê¸¸ì´ ì•„ë‹ˆì•¼");
    userInput = []; // ì˜¤ë‹µ ì‹œ ì´ˆê¸°í™”
  }
}

/* ===== íŒíŠ¸/ì •ë‹µ ë³´ê¸° ===== */
$hint1.onclick = () => {
  openModal("ì§€ë„ë¥¼ ì°¾ì•˜ë‹¤ë©´ ë¨¼ì € ì•„ë˜ë°©í–¥ìœ¼ë¡œ\n ê°€ì•¼í•œë‹¤ëŠ”ê±´ ì•Œê² ì§€?");
  if (hintLevel < 1) hintLevel = 1;
  $hint2.disabled = false;
};
$hint2.onclick = () => {
  openModal("ì´ 7ë²ˆì˜ ë°©í–¥í‚¤ë¥¼ ëˆŒëŸ¬ì•¼ í•´.");
  if (hintLevel < 2) hintLevel = 2;
  $ansBtn.disabled = false;
};
$ansBtn.onclick = () => {
  openModal("â–¼, â—€, â–², â–¶, â–², â–¶, â–²");
  if (hintLevel < 3) hintLevel = 3;
};
$totalBtn.onclick = () => {
  const t = Number(localStorage.getItem(CHURU_KEY)||"0");
  openModal(`í˜„ì¬ê¹Œì§€ íšë“í•œ ì¸„ë¥´: ${t}ê°œ`);
};

/* ===== ì •ë‹µ ì²˜ë¦¬(í•œ ë²ˆë§Œ ê°€ì‚°) â†’ ì˜ìƒ â†’ ë‹¤ìŒ í˜ì´ì§€ ===== */
function handleCorrectOnce(){
  // ì´ë¯¸ ì²˜ë¦¬í•œ ì  ìˆìœ¼ë©´ ê°€ì‚° ì—†ì´ ì˜ìƒë§Œ
  if (localStorage.getItem(PAGE_KEY) === "1"){
    playRewardAndGo();
    return;
  }
  const addMap = [3,2,1,0];      // íŒíŠ¸ ì‚¬ìš©ëŸ‰ì— ë”°ë¥¸ íšë“ëŸ‰
  const add = addMap[hintLevel] ?? 0;
  const cur = Number(localStorage.getItem(CHURU_KEY)||"0");
  localStorage.setItem(CHURU_KEY, String(cur + add));
  localStorage.setItem(PAGE_KEY, "1"); // âœ… ì¤‘ë³µê°€ì‚° ë°©ì§€

  playRewardAndGo();
}

function playRewardAndGo(){
  const src = ["curu1.mp4","curu2.mp4","curu3.mp4","curu4.mp4"][hintLevel] || "curu4.mp4";
  $video.src = src;

  // ğŸ”‡ ìŒì†Œê±° ë³´ì¥ (ëª¨ë°”ì¼ ìë™ì¬ìƒ-Friendly)
  $video.muted = true;
  $video.defaultMuted = true;
  $video.volume = 0;

  $video.currentTime = 0;
  $overlay.style.display = "flex";
  $overlay.setAttribute("aria-hidden","false");

  // í•˜ë‹¨ ë²„íŠ¼ ì ê¸ˆ
  [$hint1,$hint2,$ansBtn,$totalBtn].forEach(b=>b.disabled = true);

  // ì˜ìƒ ì¢…ë£Œ â†’ ë‹¤ìŒ í˜ì´ì§€
  $video.onended = () => { location.href = nextUrl; };

  // ìë™ì¬ìƒ ì‹œë„, ì‹¤íŒ¨ ì‹œ controls ë…¸ì¶œ
  const p = $video.play();
  if (p && typeof p.catch === "function"){
    p.catch(()=>{ $video.setAttribute("controls","controls"); });
  }
}
</script>
</body>
</html>

