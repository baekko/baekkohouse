<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>ê´€ì¥ë‹˜ì˜ ë¹„ë°€ì—…ë¬´</title>
<style>
  body{
    background-image:url("ctm3.jpg");
    background-size:cover;background-position:center;background-attachment:fixed;
    font-family:Arial,sans-serif;margin:0;
  }
  .container{
    background-color:rgba(0,0,0,.4);
    padding:10px;border-radius:10px;text-align:center;
    position:fixed;bottom:50px;left:50%;transform:translateX(-50%);
    width:60%;max-width:375px;display:flex;flex-direction:column;align-items:center;
  }
  .button-row{
    position:fixed;bottom:15px;left:50%;transform:translateX(-50%);
    display:flex;gap:10px;
  }
  .input-wrap{display:flex;align-items:center;width:100%;justify-content:center;}
  input{
    padding:8px;font-size:14px;width:60%;border:none;border-radius:5px;margin-right:10px;
    caret-color:orange;
  }
  button{
    padding:4px 6px;width:65px;font-size:12px;font-weight:bold;cursor:pointer;
    color:#fff;background:orange;border:none;border-radius:5px;box-shadow:0 4px 6px rgba(0,0,0,.46);
  }
  button:disabled{background:#6d5d5d!important;cursor:not-allowed;opacity:.9}

  /* ëª¨ë‹¬ */
  .modal{
    display:none;position:fixed;z-index:1000;left:50%;top:50%;transform:translate(-50%,-50%);
    width:300px;padding:15px;background:#fff;border-radius:10px;box-shadow:0 4px 8px rgba(0,0,0,.2);
  }
  .modal-content{text-align:center}
  .close{float:right;cursor:pointer;font-size:20px;font-weight:bold}

  /* ì •ë‹µ ì˜ìƒ ì˜¤ë²„ë ˆì´ */
  .video-overlay{
    display:none; /* ì´ˆê¸°ì—” none, ë³´ì—¬ì¤„ ë•Œ JSì—ì„œ flexë¡œ ë³€ê²½ */
    position:fixed;inset:0;background:rgba(0,0,0,.6);z-index:2000;
    align-items:center;justify-content:center;
  }
  .video-box{
    width:min(70vw,420px);background:#000;border-radius:12px;overflow:hidden;
    box-shadow:0 10px 24px rgba(0,0,0,.35);
  }
  video{width:100%;height:auto;display:block}
  @media (max-width:768px){
      .container{width:80%;padding:10px;}
      input{font-size:12px;width:60%;}
      button{font-size:12px;padding:4px 6px;}
    }
</style>
</head>
<body>
  <div class="container">
    <div class="input-wrap">
      <input id="answer" type="text" autocomplete="off" />
      <button id="submitBtn">ì…ë ¥</button>
    </div>
  </div>

  <div class="button-row">
    <button id="hint1">íŒíŠ¸ 1</button>
    <button id="hint2" disabled>íŒíŠ¸ 2</button>
    <button id="reveal" disabled>ì •ë‹µ ë³´ê¸°</button>
    <button id="totalBtn">ì¸„ë¥´ í•©ê³„</button>
  </div>

  <!-- ì•ˆë‚´ ëª¨ë‹¬ -->
  <div id="modal" class="modal" role="dialog" aria-modal="true">
    <div class="modal-content">
      <span id="closeModal" class="close">&times;</span>
      <p id="modalText"></p>
    </div>
  </div>

  <!-- ë³´ìƒ ì˜ìƒ -->
  <div id="videoOverlay" class="video-overlay" aria-hidden="true">
    <div class="video-box">
      <video id="rewardVideo" playsinline></video>
    </div>
  </div>

<script>
/* ===== í˜ì´ì§€ë³„ ì„¤ì • ===== */
const correctAnswer = "0351";
const nextUrl = "https://baekko.github.io/baekkohouse/ctm4.html";

/* ===== ìƒíƒœ ===== */
// íŒíŠ¸ ë‹¨ê³„: 0(ì—†ìŒ)->1(íŒíŠ¸1)->2(íŒíŠ¸2)->3(ì •ë‹µë³´ê¸°)
let hintLevel = 0;

// í•©ê³„ í‚¤: churuTotal (ëˆ„ì ), í˜ì´ì§€ ì²˜ë¦¬ í‚¤(ì¤‘ë³µ ê°€ì‚° ë°©ì§€)
const PAGE_KEY = "settled:" + location.pathname;

// ìŠ¤í† ë¦¬ì§€ ì¤€ë¹„
if (localStorage.getItem("churuTotal") === null) localStorage.setItem("churuTotal","0");

/* ===== ì—˜ë¦¬ë¨¼íŠ¸ ===== */
const $answer   = document.getElementById('answer');
const $submit   = document.getElementById('submitBtn');
const $hint1    = document.getElementById('hint1');
const $hint2    = document.getElementById('hint2');
const $reveal   = document.getElementById('reveal');
const $totalBtn = document.getElementById('totalBtn');

const $modal     = document.getElementById('modal');
const $modalText = document.getElementById('modalText');
const $close     = document.getElementById('closeModal');

const $overlay = document.getElementById('videoOverlay');
const $video   = document.getElementById('rewardVideo');

/* ===== ê³µí†µ UI ===== */
function openModal(msg){ $modalText.innerText = msg; $modal.style.display = "block"; }
function closeModal(){ $modal.style.display = "none"; }
$close.onclick = closeModal;
window.addEventListener('click', (e)=>{ if(e.target === $modal) closeModal(); });

/* ===== íŒíŠ¸ ì§„í–‰ ===== */
$hint1.onclick = () => {
  openModal("ì…êµ¬ì— ë„ì„œê´€ ì´ìš©ì•ˆë‚´ë¥¼ ì°¾ì•„ ë´.");
  if (hintLevel < 1) hintLevel = 1;
  $hint2.disabled = false;
};
$hint2.onclick = () => {
  openModal("í•´ë¯¸ë„ì„œê´€ ì „í™”ë²ˆí˜¸: 041-688-XXXX.");
  if (hintLevel < 2) hintLevel = 2;
  $reveal.disabled = false;
};
$reveal.onclick = () => {
  openModal("0351");
  if (hintLevel < 3) hintLevel = 3;
};

$totalBtn.onclick = () => {
  const total = Number(localStorage.getItem("churuTotal")||"0");
  openModal(`í˜„ì¬ê¹Œì§€ íšë“í•œ ì¸„ë¥´: ${total}ê°œ`);
};

/* ===== ì •ë‹µ ì²˜ë¦¬ ===== */
function handleCorrectOnce(){
  // ì´ë¯¸ ì²˜ë¦¬í–ˆë‹¤ë©´ ì¬ê°€ì‚° ì—†ì´ ë°”ë¡œ ì˜ìƒâ†’ì´ë™ë§Œ
  if (localStorage.getItem(PAGE_KEY) === "1") {
    playRewardAndGo();
    return;
  }
  const addMap = [3,2,1,0];
  const add = addMap[hintLevel] ?? 0;
  const current = Number(localStorage.getItem("churuTotal")||"0");
  localStorage.setItem("churuTotal", String(current + add));
  localStorage.setItem(PAGE_KEY, "1"); // âœ… localStorageë¡œ í†µì¼
  playRewardAndGo();
}

function playRewardAndGo(){
  const src = ["curu1.mp4","curu2.mp4","curu3.mp4","curu4.mp4"][hintLevel] || "curu4.mp4";
  $video.src = src;

  // ğŸ”‡ ìë™ì¬ìƒ ì•ˆì •í™”(ëª¨ë°”ì¼)
  $video.muted = true;
  $video.defaultMuted = true;
  $video.volume = 0;

  $video.currentTime = 0;
  $overlay.style.display = "flex";
  $overlay.setAttribute("aria-hidden","false");

  // ì…ë ¥/ë²„íŠ¼ ì ê¸ˆ
  [$submit,$hint1,$hint2,$reveal,$totalBtn].forEach(b=>b.disabled = true);

  // ì¢…ë£Œë˜ë©´ ë‹¤ìŒ í˜ì´ì§€
  $video.onended = ()=>{ location.href = nextUrl; };

  // ìë™ì¬ìƒ ë³´ì¡°
  const p = $video.play();
  if (p && typeof p.catch === 'function') {
    p.catch(()=>{ $video.setAttribute('controls','controls'); });
  }
}

/* ===== ì œì¶œ ===== */
function checkAnswer(){
  const val = ($answer.value||"").trim();
  if (val === correctAnswer) {
    closeModal();
    handleCorrectOnce();
  } else {
    openModal("ì‹¤ë§ì¸ë°.. í•´ë¯¸ë„ì„œê´€ ì „í™”ë²ˆí˜¸ë„ ëª°ë¼?");
  }
}

$submit.onclick = checkAnswer;
$answer.addEventListener('keydown', e => { if (e.key === 'Enter') checkAnswer(); });
</script>
</body>
</html>


