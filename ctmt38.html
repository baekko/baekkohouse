<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ê´€ì¥ë‹˜ì˜ ë¹„ë°€ì—…ë¬´</title>
<style>
  body{
    background-image:url("ctmt38.jpg");
    background-size:cover;background-position:center;background-attachment:fixed;
    font-family:Arial,sans-serif;margin:0;
  }
  .grid-container{
    display:grid;grid-template-columns:repeat(7,1fr);gap:0;width:70vw;max-width:350px;
    transform:translateX(-6px);top:100px;margin-left:auto;margin-right:auto;
  }
  .image-box{
    width:100%;aspect-ratio:1/1;border:.2px solid rgb(192,191,191);background-size:cover;cursor:pointer;
  }
  .container{
    background:rgba(0,0,0,.4);padding:10px;border-radius:10px;text-align:center;
    position:fixed;bottom:50px;left:50%;transform:translateX(-50%);width:60%;max-width:375px;
    display:flex;flex-direction:column;align-items:center;
  }
  .button-container{
    position:fixed;bottom:15px;left:50%;transform:translateX(-50%);display:flex;gap:10px;
  }
  .input-container{display:flex;align-items:center;width:100%;justify-content:center;}
  input{
    padding:8px;font-size:14px;width:60%;border:none;border-radius:5px;margin-right:10px;caret-color:orange;
  }
  button{
    padding:4px 6px;width:65px;font-size:12px;font-weight:bold;cursor:pointer;color:#fff;
    background:orange;border:none;border-radius:5px;box-shadow:0 4px 6px rgba(0,0,0,.466);
  }
  button:disabled{background:rgb(109,93,93)!important;cursor:not-allowed;opacity:.8}
  .modal{
    display:none;position:fixed;z-index:1000;left:50%;top:50%;transform:translate(-50%,-50%);
    width:300px;padding:15px;background:#fff;border-radius:10px;box-shadow:0 4px 8px rgba(0,0,0,.2);
  }
  .modal-content{text-align:center;position:relative;}
  #modalTextBelow{text-align:center;display:block;margin-top:10px;}
  #correctModal img{display:block;margin:0 auto;}
  #correctModal{background:#fff}
  .close{
    position:absolute;top:50%;right:10px;transform:translateY(-50%);font-size:20px;font-weight:bold;cursor:pointer;
  }
  .modal img{max-width:100%;margin-top:10px;}
  .highlight-text{color:orange;font-weight:bold;}
  @media (max-width:768px){
    .grid-container{margin-top:40px;}
    .container{width:80%;padding:10px;}
    input{font-size:12px;width:60%;}
    button{font-size:12px;padding:4px 6px;}
  }
  /* ë³´ìƒ ì˜ìƒ ì˜¤ë²„ë ˆì´ */
  .video-overlay{
    display:none;position:fixed;inset:0;background:rgba(0,0,0,.6);
    z-index:2000;align-items:center;justify-content:center;
  }
  .video-box{
    width:min(70vw,420px);background:#000;border-radius:12px;overflow:hidden;box-shadow:0 10px 24px rgba(0,0,0,.35);
  }
  video{width:100%;height:auto;display:block}
</style>
</head>
<body>
  <div class="grid-container" id="grid"></div>

  <div class="container">
    <div class="input-container">
      <input type="text" id="answer" autocomplete="off">
      <button id="submitBtn">ì…ë ¥</button>
    </div>
  </div>

  <div class="button-container">
    <button id="hint1">íŒíŠ¸ 1</button>
    <button id="hint2" disabled>íŒíŠ¸ 2</button>
    <button id="answerBtn" disabled>ì •ë‹µ ë³´ê¸°</button>
    <button id="totalBtn">ì¸„ë¥´ í•©ê³„</button>
  </div>

  <!-- ì¼ë°˜ ì•ˆë‚´ ëª¨ë‹¬ -->
  <div id="modal" class="modal">
    <div class="modal-content">
      <span class="close" id="closeModal">&times;</span>
      <p id="modalText"></p>
    </div>
  </div>

  <!-- 1ë‹¨ê³„ ì •ë‹µ ëª¨ë‹¬ -->
  <div id="correctModal" class="modal">
    <span class="close" id="closeCorrect">&times;</span>
    <img id="modalImage" src="racoonman.png" alt="ì •ë‹µ ì´ë¯¸ì§€">
    <p id="modalTextBelow">
      ë„ˆêµ¬ë¦¬ì˜€ì–ì•„!<br><br>ë§¤íŠœì˜ ì§‘ì„ ì–´ì§€ëŸ½íŒ ë„ˆêµ¬ë¦¬ë¥¼ ì°¾ì•„ì•¼ í•´.
            <br><br>ë„ˆêµ¬ë¦¬ë¥¼ ì°¾ì•„ ë³µìˆ˜í•˜ë ¤ë©´<br>ê³ ì–‘ì´ë“¤ì˜ ëŒ€ì¥ì„ ì•Œì•„ë‚´ì•¼ í•´.<br>ê³ ì–‘ì´ ëŒ€ì¥ì— ëŒ€í•œ ë‹¨ì„œê°€<br>ë°”ë¡œ ì˜† ì‚¬ë¬¼í•¨ì— ìˆì–´!<br>ì´ ì°½ì„ ë‹«ê³  ë„ˆêµ¬ë¦¬ë¥¼ í•œë²ˆì”©ë§Œ ë” ëˆŒëŸ¬!<br>ê·¸ë¦¬ê³  ê·¸ ìˆ«ìë¥¼ ì…ë ¥ì°½ì— ì…ë ¥í•´!<br><br><span class="highlight-text"></span>ìˆ«ì 4ìë¦¬ ì…ë ¥</p>
    </div>

  <!-- ë³´ìƒ ì˜ìƒ -->
  <div id="videoOverlay" class="video-overlay" aria-hidden="true">
    <div class="video-box">
      <video id="rewardVideo" playsinline muted></video>
    </div>
  </div>

<script>
/* ================== ì´ë¯¸ì§€ ê·¸ë¦¬ë“œ ================== */
const grid = document.getElementById('grid');
const allImages = [
  ['racoon0.png','racoon5.png','racoon1.png','puzzle1.png','racoon23.png'],
  ['racoon0.png','racoon17.png','racoon2.png','puzzle2.png','racoon30.png'],
  ['racoon0.png','racoon24.png','racoon16.png','racoon3.png','puzzle3.png'],
  ['racoon0.png','racoon15.png','racoon30.png','racoon3.png','puzzle4.png'],
  ['racoon0.png','racoon8.png','racoon29.png','racoon3.png','puzzle3.png'],
  ['racoon0.png','racoon11.png','racoon4.png','puzzle1.png','racoon25.png'],
  ['racoon0.png','racoon16.png','racoon5.png','puzzle2.png','racoon28.png'],
  ['racoon0.png','racoon6.png','puzzle5.png','racoon8.png','racoon12.png'],
  ['racoon0.png','racoon13.png','racoon7.png','puzzle6.png','racoon10.png'],
  ['racoon0.png','racoon18.png','racoon19.png','racoon8.png','puzzle7.png'],
  ['racoon0.png','racoon19.png','racoon18.png','racoon9.png','puzzle6.png'],
  ['racoon0.png','racoon17.png','racoon16.png','racoon10.png','puzzle8.png'],
  ['racoon0.png','racoon25.png','racoon11.png','puzzle5.png','racoon22.png'],
  ['racoon0.png','racoon12.png','puzzle5.png','racoon24.png','racoon5.png'],
  ['racoon0.png','racoon23.png','racoon9.png','racoon13.png','puzzle9.png'],
  ['racoon0.png','racoon25.png','racoon24.png','racoon14.png','puzzle10.png'],
  ['racoon0.png','racoon18.png','racoon15.png','puzzle11.png','racoon19.png'],
  ['racoon0.png','racoon10.png','racoon16.png','puzzle12.png','racoon18.png'],
  ['racoon0.png','racoon25.png','racoon15.png','puzzle13.png','racoon24.png'],
  ['racoon0.png','racoon30.png','racoon26.png','racoon17.png','puzzle14.png'],
  ['racoon0.png','racoon13.png','racoon9.png','racoon18.png','puzzle15.png'],
  ['racoon0.png','racoon19.png','puzzle6.png','racoon12.png','racoon20.png'],
  ['racoon0.png','racoon17.png','racoon20.png','puzzle5.png','racoon24.png'],
  ['racoon0.png','racoon18.png','racoon2.png','racoon21.png','puzzle7.png'],
  ['racoon0.png','racoon19.png','racoon16.png','racoon22.png','puzzle7.png'],
  ['racoon0.png','racoon20.png','racoon27.png','racoon23.png','puzzle8.png'],
  ['racoon0.png','racoon30.png','racoon24.png','puzzle5.png','racoon2.png'],
  ['racoon0.png','racoon25.png','puzzle5.png','racoon30.png','racoon6.png'],
  ['racoon0.png','racoon26.png','puzzle16.png','racoon16.png','racoon2.png'],
  ['racoon0.png','racoon27.png','puzzle17.png','racoon18.png','racoon24.png'],
  ['racoon0.png','racoon1.png','racoon28.png','puzzle18.png','racoon26.png'],
  ['racoon0.png','racoon24.png','racoon29.png','puzzle19.png','racoon22.png'],
  ['racoon0.png','racoon17.png','racoon30.png','puzzle18.png','racoon25.png'],
  ['racoon0.png','racoon31.png','puzzle16.png','racoon20.png','racoon23.png'],
  ['racoon0.png','racoon32.png','puzzle17.png','racoon12.png','racoon24.png'],
  ...Array.from({length:33},(_,i)=>[
    `image${i+4}_1.jpg`,`image${i+4}_2.jpg`,`image${i+4}_3.jpg`,`image${i+4}_4.jpg`,`image${i+4}_5.jpg`
  ])
];

for (let i=0;i<35;i++){
  const box=document.createElement('div');
  box.classList.add('image-box');
  let idx=0;
  box.style.backgroundImage=`url(${allImages[i][idx]})`;
  box.addEventListener('click',()=>{
    idx=(idx+1)%allImages[i].length;
    box.style.backgroundImage=`url(${allImages[i][idx]})`;
  });
  grid.appendChild(box);
}

/* ================== ìƒíƒœ / ìŠ¤í† ë¦¬ì§€ ================== */
const nextUrl = "https://baekko.github.io/baekkohouse/ctm41.html";

let currentAnswer = "ë„ˆêµ¬ë¦¬"; // Q1 â†’ Q2("5638")
let currentQuestion = 1;       // 1 ë˜ëŠ” 2

let answeredQuestions = 0;
let hintLevel1 = 0; // Q1 íŒíŠ¸ ë‹¨ê³„
let hintLevel2 = 0; // Q2 íŒíŠ¸ ë‹¨ê³„

const CHURU_KEY = "churuTotal";
const PAGE_KEY_Q1 = "settled:" + location.pathname + ":q1";
const PAGE_KEY_Q2 = "settled:" + location.pathname + ":q2";

if (localStorage.getItem(CHURU_KEY) === null) localStorage.setItem(CHURU_KEY,"0");

/* ================== íŒíŠ¸/ì •ë‹µ í…ìŠ¤íŠ¸ ================== */
const hints = {
  "ë„ˆêµ¬ë¦¬": {
    hint1: "0ì„ í„°ì¹˜ í•˜ë©´ ê·¸ë¦¼ì´ ë°”ë€”ê±°ì•¼!",
    hint2: "ê° ì¹¸ì˜ ìˆ«ìë§Œí¼ í„°ì¹˜í•´!",
    answer: "ë„ˆêµ¬ë¦¬"
  },
  "5638": {
    hint1: "ë„ˆêµ¬ë¦¬ë¥¼ ê±´ë“œë ¤!",
    hint2: "ë„ˆêµ¬ë¦¬ë¥¼ í•œ ë²ˆì”©ë§Œ ë” ëˆŒëŸ¬ ë³´ë¼ë‹ˆê¹Œ!",
    answer: "5638"
  }
};
const wrongMessages = {
  "ë„ˆêµ¬ë¦¬": "ì¹¨ì…ìê°€ ì•„ëƒ.",
  "5638": "í•œ ë²ˆì”©ë§Œ ë” ëˆ„ë¥´ë©´ ëœë‹¤ê³ !"
};

/* ================== ìš”ì†Œ ================== */
const $answer = document.getElementById('answer');
const $submit = document.getElementById('submitBtn');

const $modal = document.getElementById('modal');
const $modalText = document.getElementById('modalText');
const $close = document.getElementById('closeModal');

const $correctModal = document.getElementById('correctModal');
const $closeCorrect = document.getElementById('closeCorrect');

const $hint1 = document.getElementById('hint1');
const $hint2 = document.getElementById('hint2');
const $ansBtn = document.getElementById('answerBtn');
const $totalBtn = document.getElementById('totalBtn');

const $overlay = document.getElementById('videoOverlay');
const $video = document.getElementById('rewardVideo');

/* ================== ëª¨ë‹¬ ê³µí†µ ================== */
function openModal(txt){ $modalText.innerText = txt; $modal.style.display="block"; }
function closeModal(){ $modal.style.display="none"; }
$close.onclick = closeModal;
window.addEventListener('click', e => { if (e.target === $modal) closeModal(); });

/* ================== íŒíŠ¸/ì •ë‹µ ë³´ê¸° ================== */
$hint1.onclick = ()=>{
  openModal(hints[currentAnswer].hint1);
  if (currentQuestion === 1) { if (hintLevel1 < 1) hintLevel1 = 1; }
  else { if (hintLevel2 < 1) hintLevel2 = 1; }
  $hint2.disabled = false;
};
$hint2.onclick = ()=>{
  openModal(hints[currentAnswer].hint2);
  if (currentQuestion === 1) { if (hintLevel1 < 2) hintLevel1 = 2; }
  else { if (hintLevel2 < 2) hintLevel2 = 2; }
  $ansBtn.disabled = false;
};
$ansBtn.onclick = ()=>{
  openModal(hints[currentAnswer].answer);
  if (currentQuestion === 1) { if (hintLevel1 < 3) hintLevel1 = 3; }
  else { if (hintLevel2 < 3) hintLevel2 = 3; }
};
$totalBtn.onclick = ()=>{
  const t = Number(localStorage.getItem(CHURU_KEY)||"0");
  openModal(`í˜„ì¬ê¹Œì§€ íšë“í•œ ì¸„ë¥´: ${t}ê°œ`);
};

/* ================== ì •ë‹µ ì œì¶œ ================== */
$submit.onclick = checkAnswer;
$answer.addEventListener('keydown', e=>{ if(e.key === 'Enter') checkAnswer(); });

function checkAnswer(){
  const v = ($answer.value||"").trim();
  if (v === currentAnswer){
    answeredQuestions++;
    if (currentQuestion === 1){
      handleClearQ1(); // Q1 ì •ë‹µ ì²˜ë¦¬(ì˜ìƒ + ê°€ì‚°) â†’ ì˜ìƒ ëë‚˜ë©´ ë¼ì¿¤ ëª¨ë‹¬
    }else{
      handleClearQ2(); // Q2 ì •ë‹µ ì²˜ë¦¬(ì˜ìƒ + ê°€ì‚°) â†’ ì˜ìƒ ëë‚˜ë©´ ë‹¤ìŒ í˜ì´ì§€
    }
  }else{
    openModal(wrongMessages[currentAnswer] || "ì˜¤ë‹µì…ë‹ˆë‹¤! ë‹¤ì‹œ ì‹œë„í•´ë³´ì„¸ìš”.");
  }
}

/* ================== ë¬¸ì œ ì „í™˜ ================== */
$closeCorrect.onclick = ()=>{
  $correctModal.style.display = "none";
  goNextQuestion("5638");
};

function goNextQuestion(nextAnswer){
  currentAnswer = nextAnswer;
  currentQuestion = 2;

  // ì…ë ¥ì°½ ì´ˆê¸°í™”
  $answer.value = "";

  // íŒíŠ¸ UI ì´ˆê¸°í™”
  $hint1.disabled = false;
  $hint2.disabled = true;
  $ansBtn.disabled = true;
}

/* ================== ë³´ìƒ/ê°€ì‚° ê³µí†µ ================== */
const addMap = [3,2,1,0]; // 0~3ë‹¨ê³„ â†’ 3/2/1/0ê°œ

function awardOnceAndPlay(questionIdx, hintLevelUsed, afterVideo){
  const key = (questionIdx === 1) ? PAGE_KEY_Q1 : PAGE_KEY_Q2;

  // 1) ê°€ì‚°(ì¤‘ë³µ ë°©ì§€)
  if (localStorage.getItem(key) !== "1"){
    const add = addMap[hintLevelUsed] ?? 0;
    const cur = Number(localStorage.getItem(CHURU_KEY)||"0");
    localStorage.setItem(CHURU_KEY, String(cur + add));
    localStorage.setItem(key, "1");
  }

  // 2) ì˜ìƒ ì¬ìƒ
  playRewardFor(hintLevelUsed, afterVideo);
}

function playRewardFor(hintLevelUsed, afterVideo){
  const src = ["curu1.mp4","curu2.mp4","curu3.mp4","curu4.mp4"][hintLevelUsed] || "curu4.mp4";
  $video.src = src;

  // ğŸ”‡ ëª¨ë°”ì¼ ìë™ì¬ìƒ ì•ˆì •í™”
  $video.muted = true; $video.defaultMuted = true; $video.volume = 0;

  // í•˜ë‹¨ ë²„íŠ¼ ì ê¸ˆ
  [$hint1,$hint2,$ansBtn,$totalBtn,$submit].forEach(b=>b.disabled = true);

  $video.currentTime = 0;
  $overlay.style.display = "flex";
  $overlay.setAttribute("aria-hidden","false");

  $video.onended = ()=>{
    // ì˜¤ë²„ë ˆì´ ë‹«ê¸°
    $overlay.style.display = "none";
    // ì´í›„ ë™ì‘
    if (typeof afterVideo === 'function') afterVideo();
  };

  const p = $video.play();
  if (p && typeof p.catch === "function"){
    p.catch(()=>{ $video.setAttribute('controls','controls'); });
  }
}

/* ================== ê° ë¬¸ì œ ì²˜ë¦¬ ================== */
function handleClearQ1(){
  const used = hintLevel1; // Q1ì—ì„œ ì‚¬ìš©í•œ íŒíŠ¸ ë‹¨ê³„
  awardOnceAndPlay(1, used, ()=>{
    // Q1 ë³´ìƒ ëë‚œ ë’¤ ë¼ì¿¤ ëª¨ë‹¬ ì—´ê¸°
    $correctModal.style.display = "block";
    // ëª¨ë‹¬ ìƒíƒœì—ì„œ ë²„íŠ¼ ì¬í™œì„±í™”(ë‹¤ìŒ ë‹¨ê³„ë¡œ ë„˜ì–´ê°€ê²Œ)
    $hint1.disabled = false;
    $hint2.disabled = true;
    $ansBtn.disabled = true;
    $submit.disabled = false;
  });
}

function handleClearQ2(){
  const used = hintLevel2; // Q2ì—ì„œ ì‚¬ìš©í•œ íŒíŠ¸ ë‹¨ê³„
  awardOnceAndPlay(2, used, ()=>{
    // Q2 ë³´ìƒ ëë‚˜ë©´ ë‹¤ìŒ í˜ì´ì§€
    location.href = nextUrl;
  });
}
</script>
</body>
</html>




